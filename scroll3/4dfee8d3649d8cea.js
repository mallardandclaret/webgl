import"./style.css";import*as THREE from"three";import*as dat from"lil-gui";import{GLTFLoader}from"three/examples/jsm/loaders/GLTFLoader.js";import{gsap}from"gsap";import{ScrollTrigger}from"gsap/ScrollTrigger";gsap.registerPlugin(ScrollTrigger),console.clear();var loader=new GLTFLoader;const cubeTextureLoader=new THREE.CubeTextureLoader,gui=new dat.GUI,debugObject={};var renderer=new THREE.WebGLRenderer({alpha:!0,antialiase:!0});renderer.setSize(window.innerWidth,window.innerHeight),renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),document.body.appendChild(renderer.domElement);var scene=new THREE.Scene;const updateAllMaterials=()=>{scene.traverse((e=>{e instanceof THREE.Mesh&&e.material instanceof THREE.MeshStandardMaterial&&(e.material.envMapIntensity=debugObject.envMapIntensity,e.material.needsUpdate=!0,e.castShadow=!0,e.receiveShadow=!0)}))},environmentMap=cubeTextureLoader.load(["textures/environmentMaps/3/px.jpg","textures/environmentMaps/3/nx.jpg","textures/environmentMaps/3/py.jpg","textures/environmentMaps/3/ny.jpg","textures/environmentMaps/3/pz.jpg","textures/environmentMaps/3/nz.jpg"]);environmentMap.encoding=THREE.sRGBEncoding,scene.background=environmentMap,scene.environment=environmentMap,debugObject.envMapIntensity=2.5,gui.add(debugObject,"envMapIntensity").min(0).max(10).step(.001).onChange(updateAllMaterials);var camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);camera.position.z=25,camera.position.y=0;const directionalLight=new THREE.DirectionalLight("#ffffff",3);var mixer,model;directionalLight.castShadow=!0,directionalLight.shadow.camera.far=15,directionalLight.shadow.mapSize.set(1024,1024),directionalLight.shadow.normalBias=.05,directionalLight.position.set(.25,3,-2.25),scene.add(directionalLight),gui.add(directionalLight,"intensity").min(0).max(10).step(.001).name("lightIntensity"),gui.add(directionalLight.position,"x").min(-5).max(5).step(.001).name("lightX"),gui.add(directionalLight.position,"y").min(-5).max(5).step(.001).name("lightY"),gui.add(directionalLight.position,"z").min(-5).max(5).step(.001).name("lightZ"),renderer.physicallyCorrectLights=!0,renderer.outputEncoding=THREE.sRGBEncoding,renderer.toneMapping=THREE.ReinhardToneMapping,renderer.toneMappingExposure=3,renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.PCFSoftShadowMap,gui.add(renderer,"toneMapping",{No:THREE.NoToneMapping,Linear:THREE.LinearToneMapping,Reinhard:THREE.ReinhardToneMapping,Cineon:THREE.CineonToneMapping,ACESFilmic:THREE.ACESFilmicToneMapping}).onFinishChange((()=>{renderer.toneMapping=Number(renderer.toneMapping),updateAllMaterials()})),gui.add(renderer,"toneMappingExposure").min(0).max(10).step(.001),window.addEventListener("resize",(function(){let e=window.innerWidth,n=window.innerHeight;renderer.setSize(e,n),camera.aspect=e/n,camera.updateProjectionMatrix()})),loader.load("models/GAS9a.gltf",(function(e){e.scene.traverse((function(e){e instanceof THREE.Mesh&&(e.castShadow=!0,e.material.side=THREE.DoubleSide)})),(model=e.scene).scale.set(5,5,5),model.position.set(0,-10,5),model.rotation.z+=.3,model.rotation.x+=.3,scene.add(model);var n=(mixer=new THREE.AnimationMixer(model)).clipAction(e.animations[0]);n.play(),createAnimation(mixer,n,e.animations[0])}));var clock=new THREE.Clock;function render(){requestAnimationFrame(render);var e=clock.getDelta();null!=mixer&&mixer.update(e),model&&(model.rotation.y+=.01),renderer.render(scene,camera)}function createAnimation(e,n,i){let r={get time(){return e.time},set time(i){n.paused=!1,e.setTime(i),n.paused=!0}};gsap.timeline({scrollTrigger:{trigger:renderer.domElement,start:"top top",end:"+=500%",pin:!0,scrub:!0,onUpdate:function(){camera.updateProjectionMatrix()}}}).to(r,{time:i.duration,repeat:0})}render(),gsap.registerPlugin(ScrollTrigger);